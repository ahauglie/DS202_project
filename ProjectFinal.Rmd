---
title: "ProjectWork"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

 **Importing the Data**
 
```{r}
library("readxl")
library(dplyr)
library(tidyverse)
library(ggplot2)
library(plotly)
dat <- read_excel("ALL.xlsx")
dat <- select(dat, -Player2, -Player3)
```
Create Variables we need
```{r}
  dat <- mutate(dat, RBIAB = RBI / AB) ##Round these to .000 decimals if possible
  ##Runs batted in per at bat^
  dat <- mutate(dat, HRAB = HR / AB)  ##Round these to .000 decimals if possible
  ##Home Runs per at bat^
  dat <- mutate(dat, BABIP = (H - HR) / (AB - SO - HR + SF)) ##Round these to .000 decimals if possible
  ##Batting Average on Balls in Play^
  dat$NP <- as.numeric(dat$NP) ##Cleaning the Data, changing column from character to Number
  dat <- mutate(dat, NPPA = NP / PA) #ROUND TO 3 digits
  ##Number of pitches per plate appearance^
  dat <- mutate(dat, NPAB = NP / AB) #ROUND TO 3 digits
  ##Number of Pitches per At bat per at bat^
  dat <- mutate(dat, SOAB = SO / AB) #ROUND TO 3 digits
   ##Number of StrikeOuts per at bat^
```


Visualize the Data
```{r}
ggplot(dat, aes(x = AVG)) + geom_histogram(binwidth = .002,color="Black", fill="light blue") + xlab("Batting Average") + ggtitle("Histogram of Batting Average") + ylab("Count")

ggplot(dat, aes(x = OPS)) + geom_histogram(binwidth = .005,color="Black", fill="light green") + xlab("On-Base + Slugging Percentage") + ggtitle("Histogram of OPS") + ylab("Count")


ggplot(dat, aes(x = RBIAB, y = SLG)) + geom_point(color = 'coral2') + geom_smooth(method='lm',formula=y~x) + xlab("RBI per At bat") + ggtitle("Relationship between Slugging Percentage and RBI's per At Bat") + ylab("Slugging Percentage")## R_SQUARED


ggplot(dat, aes(x = HRAB, y = NPPA)) + geom_point() + geom_smooth(method='lm',formula=y~x) ## R_SQUARED
```

Which position has the best batting average?
```{r}
dat2 <- dat
dat2%>%
  select(Pos, AVG) %>%
  mutate(AVG = ifelse(AVG == -9999, NA, AVG)) %>%
  group_by(Pos) %>%
  mutate(MEANAVG = mean(AVG, na.rm = T)) -> dat2
ggplot(dat2, aes(x = AVG)) + geom_histogram(binwidth = .002,color="Black", fill="goldenrod2") + xlab("Batting Average") + ggtitle("Histogram of Batting Average by Position") + ylab("Count") + facet_wrap(~Pos) + geom_vline(aes(xintercept = MEANAVG))

dat3 <- select(dat2, -AVG)
dat3 <- distinct(dat3)  #ROUND TO 3 digits

head(dat3, 10)
# WOW, This makes no sense, as the lowest batting average on the field is the DH and the Right fielder
```
Following Albert Pujols through his career 
```{r}
Albert <- dat[grepl("Pujols,A", dat$Player),]

ggplot(Albert, aes(x = Year)) +
  geom_line(aes( y = AVG), color = "blue") +
  geom_line(aes( y = SLG), color = "red") + 
  geom_line(aes( y = HRAB), color = "purple") + 
  geom_line(aes( y = RBIAB), color = "Orange") +
  ylab("Averages") + 
  xlab("Year") + 
  ggtitle("Albert Pujols's Career mapped by Year") +
  geom_vline(xintercept = 2010, color = "Red")

a <- ggplot(Albert, aes(x = Year)) +
  geom_line(aes( y = HR), color = "blue") +
  geom_line(aes( y = SO), color = "red") + 
  geom_line(aes( y = BB), color = "purple") + 
  geom_line(aes( y = RBI), color = "Orange") +
  ylab("Totals By Category") + 
  xlab("Year") + 
  ggtitle("Albert Pujols's Career mapped by Year") +
  geom_vline(xintercept = 2010, color = "Black")
 ggplotly(a)

Trout <- dat[grepl("Trout,M", dat$Player),]

b <- ggplot(Trout, aes(x = Year)) +
  geom_line(aes( y = AVG), color = "blue") +
  geom_line(aes( y = BABIP), color = "red") + 
  geom_line(aes( y = HRAB), color = "purple") + 
  geom_line(aes( y = RBIAB), color = "Orange") +
  ylab("Averages") + 
  xlab("Year") + 
  ggtitle("Mike Trout's Career mapped by Year") 

ggplot(Trout, aes(x = Year)) +
  geom_line(aes( y = HR), color = "blue") +
  geom_line(aes( y = SB), color = "red") + 
  geom_line(aes( y = BB), color = "purple") + 
  geom_line(aes( y = RBI), color = "Orange") +
  ylab("Totals By Category") + 
  xlab("Year") + 
  ggtitle("Mike Trout's Career mapped by Year") +
  geom_vline(xintercept = 2017, color = "Black")

```
Do Homerun hitters have higher Strike Out percentages?
```{r}
ggplot(dat, aes(x = HRAB, y = SOAB)) + geom_smooth(method='lm') + geom_point() + xlab("Home Runs Per at Bat") + ggtitle("Homerun Hitters and Strike Out Percentages") + ylab("Strike outs Per at Bat")## R_SQUARED

```

Graph rivalry teams by runs scored.
```{r}
Giants <- dat[grepl("SF", dat$Team),]
Padres <- dat[grepl("SD", dat$Team),]
Rivals <- full_join(Padres, Giants)
```

Does Avg # of pitches in an at bat correlate with batting Avg? Does it correlate with HRs?

```{r}
#This one proves the Null Hypothesis, that there is no Correlation
ggplot(dat, aes(x = AVG, y = NPAB)) + geom_smooth(method='lm') + geom_point() + xlab("Batting Average") + ggtitle("Relationship Between Average Number of Pitches in an at Bat to Batting Average") + ylab("Average Number of Pitches During an at Bat")## R_SQUARED


#This one has a slight positive correlation
ggplot(dat, aes(x = HRAB, y = NPAB)) + geom_smooth(method='lm') + geom_point() + xlab("Average Homeruns in an at Bat") + ggtitle("Relationship Between Average Number of Pitches in an at Bat to Batting Average") + ylab("Average Number of Pitches During an at Bat")## R_SQUARED
```

Distribution of BABIP with Buster Posey Highlighted

```{r}
Posey <- dat[grepl("Posey,B", dat$Player),]
MeanBABIPposey <- mean(Posey$BABIP)

ggplot(dat, aes(x = BABIP,)) + geom_histogram(color = "black", fill = "white")  + geom_vline(xintercept = MeanBABIPposey, color = "Red")

```

Which teams hit the most homeruns?
```{r}
dat3 <- dat


dat3%>%
  select(Team, HRAB) %>%
  mutate(HRAB = ifelse(HRAB == -9999, NA, HRAB)) %>%
  group_by(Team) %>%
  mutate(MeanHR = mean(HRAB, na.rm = T)) -> dat3

dat4 <- select(dat3, -HRAB)
dat4 <- distinct(dat4)  #ROUND TO 3 digits
head(dat4, 10)

dat4 <- dat4[order(dat4$MeanHR, decreasing = TRUE),] 

head(dat4, 5)

```

```{r}
correlationMatrix <- select(dat, AVG, OBP, SLG, BABIP, OPS, HR, SO, RBI, BB, XBH)
cor(correlationMatrix)

```
Chloroplath map 
```{r}
Stadiums <- read_excel("StadiumLocations.xlsx")


```
